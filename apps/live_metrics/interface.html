<html>
  <head>
    <link rel="stylesheet" href="../../css/spectre.min.css">
  </head>
  <body>
    <h3>Live Metrics Settings</h3>
    <p>Enabled: <input type="checkbox" id="enabled"></p>
    <p>Server URL<br><input id="server_url" style="width:50%"></p>
    <p>Update Interval<br><input id="update_interval_in_minutes" style="width:50%"></p>
    <p>Custom ID (optional)<br><input id="bangle_id" style="width:50%"></p>
    
    <h4>Basic Auth</h4>
    <p>Enabled: <input type="checkbox" id="auth_enabled"></p>
    <p>Username<br><input id="auth_username" style="width:50%"></p>
    <p>Password<br><input id="auth_password" style="width:50%"></p>

    <button id="upload" class="btn btn-primary">Save key</button>

    <script src="../../core/lib/interface.js"></script>

    <script>
        var settings = {};
        function onInit(){
          console.log("Loading settings from BangleJs...");
          try {
            Util.readStorageJSON("live_metrics.json", data=>{
              if(data){
                settings = data;
                console.log("Got settings", settings);
                document.getElementById("enabled").value = settings.enabled;
                document.getElementById("server_url").value = settings.server_url;
                document.getElementById("update_interval_in_minutes").value = settings.update_interval_in_minutes;
                document.getElementById("bangle_id").value = settings.bangle_id;
                document.getElementById("auth_enabled").value = settings.auth_enabled;
                document.getElementById("auth_username").value = settings.auth_username;
                document.getElementById("auth_password").value = settings.auth_password;
              }
            });
          } catch(ex) {
              console.log("(Warning) Could not load settings from BangleJs.");
              console.log(ex);
          }

        }

        document.getElementById("upload").addEventListener("click", function() {
            try {
              settings.apikey = document.getElementById("apikey").value;
              Util.showModal("Saving...");
              Util.writeStorage("live_metrics.json", JSON.stringify(settings), ()=>{
                Util.hideModal();
              });
              console.log("Sent settings!");
            } catch(ex) {
                console.log("(Warning) Could not write settings to BangleJs.");
                console.log(ex);
            }
        });

    </script>
  </body>
</html>